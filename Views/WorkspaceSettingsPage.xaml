<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="RagMaui.Views.WorkspaceSettingsPage"
             BackgroundColor="#0F172A">

    <ScrollView>
        <VerticalStackLayout Padding="20,10,20,30" Spacing="20">

            <!-- CABECERA DE LA PÃGINA -->
            <VerticalStackLayout Spacing="5" Margin="0,10,0,10">
                <Label Text="ConfiguraciÃ³n" FontSize="28" FontAttributes="Bold" TextColor="#F8FAFC" />
                <Label Text="Gestiona tus workspaces, modelos y conocimiento." FontSize="14" TextColor="#94A3B8" />
            </VerticalStackLayout>

            <!-- WORKSPACE ACTUAL -->
            <Border BackgroundColor="#1E293B" Stroke="#334155" StrokeThickness="1" Padding="20" StrokeShape="RoundRectangle 16">
                <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,4" Radius="10" Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <Label Text="ðŸš€" FontSize="20" VerticalOptions="Center"/>
                        <Label Text="Workspace Actual" FontAttributes="Bold" FontSize="18" TextColor="#10B981" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                    
                    <Label Text="Selecciona el entorno de trabajo activo" TextColor="#94A3B8" FontSize="13" Margin="0,0,0,-8" />

                    <Border BackgroundColor="#0F172A"
                            Stroke="#334155"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 8"
                            Padding="12,6">

                        <Picker ItemsSource="{Binding Workspaces}"
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding SelectedWorkspace}"
                                Title="Elige un workspace"
                                TextColor="#F8FAFC"
                                TitleColor="#94A3B8"
                                BackgroundColor="Transparent"
                                FontSize="14" />

                    </Border>

                    <BoxView HeightRequest="1" Color="#334155" Margin="0,10" />

                    <Label Text="Renombrar Workspace" TextColor="#94A3B8" FontSize="13" Margin="0,0,0,-8" />
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                        <Entry Grid.Column="0" Placeholder="Nuevo nombre..." PlaceholderColor="#64748B" TextColor="#F8FAFC" Text="{Binding RenameWorkspaceName}" HeightRequest="45" VerticalOptions="Center" />
                        <Button Grid.Column="1" Text="Guardar" Command="{Binding RenameWorkspaceCommand}" WidthRequest="90" HeightRequest="45" BackgroundColor="#10B981" TextColor="#FFFFFF" CornerRadius="8" FontAttributes="Bold" Padding="0"/>
                    </Grid>

                    <Button Text="Eliminar Workspace" BackgroundColor="#EF4444" TextColor="White" Command="{Binding DeleteWorkspaceCommand}" FontAttributes="Bold" CornerRadius="8" Margin="0,10,0,0" HeightRequest="45">
                        <Button.Shadow>
                            <Shadow Brush="#EF4444" Offset="0,4" Radius="8" Opacity="0.25"/>
                        </Button.Shadow>
                    </Button>
                </VerticalStackLayout>
            </Border>

            <!-- NUEVO WORKSPACE -->
            <Border BackgroundColor="#1E293B" Stroke="#334155" StrokeThickness="1" Padding="20" StrokeShape="RoundRectangle 16">
                 <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,4" Radius="10" Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <Label Text="âž•" FontSize="20" VerticalOptions="Center"/>
                        <Label Text="Nuevo Workspace" FontAttributes="Bold" FontSize="18" TextColor="#10B981" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                    
                    <Label Text="Crea un entorno de trabajo desde cero" TextColor="#94A3B8" FontSize="13" Margin="0,0,0,-8" />
                    <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                        <Entry Grid.Column="0" Placeholder="Nombre del workspace..." PlaceholderColor="#64748B" TextColor="#F8FAFC" Text="{Binding NewWorkspaceName}" HeightRequest="45" VerticalOptions="Center" />
                        <Button Grid.Column="1" Text="Crear" Command="{Binding CreateWorkspaceCommand}" WidthRequest="90" HeightRequest="45" BackgroundColor="#10B981" TextColor="#FFFFFF" CornerRadius="8" FontAttributes="Bold" Padding="0"/>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- SYSTEM PROMPT -->
            <Border BackgroundColor="#1E293B" Stroke="#334155" StrokeThickness="1" Padding="20" StrokeShape="RoundRectangle 16">
                 <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,4" Radius="10" Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <Label Text="ðŸ¤–" FontSize="20" VerticalOptions="Center"/>
                        <Label Text="System Prompt" FontAttributes="Bold" FontSize="18" TextColor="#3B82F6" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                    
                    <Label Text="Define el comportamiento base de la IA" TextColor="#94A3B8" FontSize="13" Margin="0,0,0,-8" />
                    <Editor HeightRequest="120" Text="{Binding SystemPrompt}" Placeholder="Eres un asistente Ãºtil y detallado..." PlaceholderColor="#64748B" TextColor="#F8FAFC" Margin="0,5,0,0"/>
                    <Button Text="Guardar Prompt" Command="{Binding SavePromptCommand}" BackgroundColor="#3B82F6" TextColor="#FFFFFF" FontAttributes="Bold" CornerRadius="8" HeightRequest="45">
                        <Button.Shadow>
                            <Shadow Brush="#3B82F6" Offset="0,4" Radius="8" Opacity="0.25"/>
                        </Button.Shadow>
                    </Button>
                </VerticalStackLayout>
            </Border>

            <!-- BASE DE CONOCIMIENTO -->
            <Border BackgroundColor="#1E293B" Stroke="#334155" StrokeThickness="1" Padding="20" StrokeShape="RoundRectangle 16" Margin="0,0,0,20">
                 <Border.Shadow>
                    <Shadow Brush="Black" Offset="0,4" Radius="10" Opacity="0.15" />
                </Border.Shadow>
                <VerticalStackLayout Spacing="16">
                    <Grid ColumnDefinitions="*, Auto">
                        <HorizontalStackLayout Grid.Column="0" Spacing="10" VerticalOptions="Center">
                            <Label Text="ðŸ“„" FontSize="20" VerticalOptions="Center"/>
                            <Label Text="Conocimiento" FontAttributes="Bold" FontSize="18" TextColor="#8B5CF6" VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Button Grid.Column="1" Text="+ Subir Archivo" Command="{Binding UploadDocumentCommand}" Padding="15,0" BackgroundColor="#8B5CF6" TextColor="#FFFFFF" FontAttributes="Bold" CornerRadius="8" HeightRequest="36" VerticalOptions="Center">
                             <Button.Shadow>
                                <Shadow Brush="#8B5CF6" Offset="0,2" Radius="6" Opacity="0.3"/>
                            </Button.Shadow>
                        </Button>
                    </Grid>
                    
                    <Label Text="Documentos indexados en este workspace" TextColor="#94A3B8" FontSize="13" Margin="0,-4,0,4" />
                    
                    <Border BackgroundColor="#0F172A" Stroke="#334155" StrokeThickness="1" StrokeShape="RoundRectangle 8" Padding="5">
                        <CollectionView ItemsSource="{Binding Documents}" HeightRequest="250">
                            <CollectionView.EmptyView>
                                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Margin="0,40">
                                    <Label Text="ðŸ“‚" FontSize="40" HorizontalOptions="Center" Opacity="0.5"/>
                                    <Label Text="NingÃºn documento subido aÃºn." TextColor="#64748B" FontSize="14" HorizontalOptions="Center" Margin="0,10,0,0" />
                                    <Label Text="Sube un archivo para comenzar." TextColor="#475569" FontSize="12" HorizontalOptions="Center" />
                                </VerticalStackLayout>
                            </CollectionView.EmptyView>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border BackgroundColor="#1E293B" Stroke="#334155" StrokeThickness="1" StrokeShape="RoundRectangle 8" Margin="5" Padding="15,12">
                                        <Grid ColumnDefinitions="Auto, *">
                                            <Label Grid.Column="0" Text="ðŸ“" Margin="0,0,12,0" VerticalOptions="Center" FontSize="18" />
                                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                                <Label Text="{Binding Filename}" FontAttributes="Bold" FontSize="14" TextColor="#F8FAFC" LineBreakMode="TailTruncation" />
                                                <Label Text="{Binding Id}" FontSize="11" FontFamily="Consolas" TextColor="#64748B" LineBreakMode="TailTruncation" />
                                            </VerticalStackLayout>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Border>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>